# Maintainer: Piyush Raj Chouhan <piyushchouhan1598@gmail.com>
# Reference: <https://postmarketos.org/devicepkg>
pkgname=device-xiaomi-raphael
pkgdesc="Xiaomi Mi 9T Pro / Redmi K20 Pro"
pkgver=3
pkgrel=6
url="https://postmarketos.org"
license="MIT"
arch="aarch64"
options="!check !archcheck"
depends="
	alsa-ucm-conf-qcom-sm8150
	bootmac
	firmware-xiaomi-raphael   
	hexagonfs-firmware-loader
	hexagonrpcd
	linux-firmware-ath10k
	linux-firmware-qca
	linux-firmware-qcom
	linux-postmarketos-qcom-sm8150
	make-dynpart-mappings
	msm-firmware-loader
	msm-modem
	msm-modem-uim-selection
	postmarketos-base
	postmarketos-base
	soc-qcom
	swclock-offset
	systemd-boot
	tqftpserv
	unl0kr-fbforcerefresh
"
makedepends="devicepkg-dev"
source="
	deviceinfo
	modules-initfs
"

build() {
	devicepkg_build $startdir $pkgname
}

package() {
	devicepkg_package $startdir $pkgname

	install -Dm644 "$srcdir"/30-initramfs-firmware.files -t \
		"$pkgdir"/usr/share/mkinitfs/files

	install -Dm644 "$srcdir"/81-libssc-180-degrees.rules -t \
		"$pkgdir"/usr/lib/udev/rules.d
}

openrc() {
	install_if="$pkgname=$pkgver-r$pkgrel openrc"
	install="$subpkgname.post-install"
	depends="
		hexagonrpcd-openrc
		openrc
		qbootctl-openrc
		tqftpserv-openrc
		"

	mkdir -p "$subpkgdir"
}

sha512sums="
de3a588dde91ea521b8e269e4823f543099fb85fceac406fbf2e8a6d37d6cbfb6115cb4dc4da62488276d2e5d758858a4d0d5b3036fa2300bc3b0745b72cea14  deviceinfo
2acf9e2a4a38c36866c8f31adfe83517f0773e35936920127e2cf49d43b24af67701deef81ffa610605caccbd560574f531e155f20da7126a27529ad8f70fd37  modules-initfs
"
